<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<meta charset="UTF-8">
<meta name="viewport"
	content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link rel="preconnect" href="https://fonts.gstatic.com">
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css">
<link rel="stylesheet" type="text/css" th:href="@{/css/signup.css}">
<meta charset="UTF-8">
<title>마이페이지 회원정보수정</title>
<script type="text/javascript" th:src="@{/js/modify.js}"></script>
<script>
	function onclickAdmin() {
		// Get the checkbox
		var checkBox = document.getElementById("admin-check");
		// Get the output text
		var box = document.getElementById("admin-token");
		// If the checkbox is checked, display the output text
		if (checkBox.checked == true) {
			box.style.display = "block";
		} else {
			box.style.display = "none";
		}
	}
</script>
</head>

<body>
  <div id="modify">
    <span>회원정보 수정</span><br>
      <span class="signup-classification">아이디</span><br>
      <span class="test" th:text="${userId}"></span> <br>
      	
      <span class="signup-classification">비밀번호</span><br>
      <input id="password" name="userPassword" type="password" placeholder="변경할 비밀번호를 입력해 주세요." onfocus="checkPassword(this)">
      <span class="verification" id="passwordCheck"> </span><br>
        
      <span class="signup-classification">닉네임</span><br>
      <button type="button" class="nicknameVerificationCheckBtn">닉네임검증 </button>
      <input type="text" name="userNickname" class="login-input-nickname" placeholder="변경할 닉네임을 입력해 주세요." onfocus="nicknamecheck(this)">
      <span class="verification" id="nicknameCheck"> </span><br>

      <!-- <button id="signup-button" class="signup-button-class">회원 가입</button> -->
      <button type="button" class="btn btn-warning modifyBtn">수정하기 </button>
  </div>
  <script th:inline="javascript">
  $(document).ready(function() {
      
	  // controller에서 가져온 값을 userId라는 변수에 넣기.
	  let userId = [[${userId}]];
	  console.log("TEST ==============> " + userId);
	  
      var inputNickname = $('input[name="userNickname"]');
      var inputPassword = $('input[name="userPassword"]');
      

      
      console.log("변경할 닉네임 중 입력한 것\n" + inputNickname);

      
      $(".modifyBtn").on("click", function(){

          var data = {userId:userId, userNickname:inputNickname.val(), userPassword: inputPassword.val() };

          console.log(data);

          $.ajax({
              url: '/thisiswe/mypage/' + userId ,  
              type:"PUT",
              data:JSON.stringify(data),
              contentType:"application/json; charset=utf-8",
              dataType:"text",
              success: function(result){

                  console.log("result: " + result);

                  /* self.location.reload(); */

              }
          })
      });
      
  $(".nicknameVerificationCheckBtn").on("click", function(){
	  
      // 양식을 잘 지켯는지 확인하기 위해
      var userNicknameForm = $("#nicknameCheck").html();
      
      // 실제로 입력받은 값.
      var userNickname = $(".login-input-nickname").val();
	  
      console.log("양식을 지켰는지에 대한 내용" + userNicknameForm);
      console.log("실제로 입력받은 값" + userNickname);

              $.ajax({
                  url:'/thisiswe/userEmail/' + userNickname , //Controller에서 요청 받을 주소
                  type:"POST", // post 방식으로 전달
                  success: function(result){ //컨트롤러에서 넘어온 result값을 받는다 

                      console.log("result: " + result);

                  	if(result==true) {
                  		alert("중복이야");
                  	}
                  	else {
                  		if(userNicknameForm == "") {
                  			alert("사용해도 된다");
                  		}
                  		else
                  			alert("양식을 지켜달라에요");
                  	}
                      /* self.location.reload(); */
                  }
              })
          });
  });
  
  </script>
</body> 
</html>